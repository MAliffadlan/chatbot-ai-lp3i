<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI LP3I (Beta)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-7DN6K1JQDG"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-7DN6K1JQDG');
</script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        #chat-window::-webkit-scrollbar { width: 6px; }
        #chat-window::-webkit-scrollbar-track { background: #1f2937; }
        #chat-window::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 3px; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in-up { animation: fadeInUp 0.5s ease-out forwards; }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl h-[85vh] flex flex-col bg-gray-800 rounded-2xl shadow-2xl border border-gray-700">
        <div class="p-4 border-b border-gray-700 flex items-center space-x-4">
           <img src="static/lp3i1.png" alt="Logo LP3I" class="w-12 h-12 rounded-full object-cover border-2 border-purple-400 flex-shrink-0">
            <div>
                <h1 class="text-xl font-bold">AI LP3I (Beta)</h1>
                <p class="text-sm text-green-400 flex items-center">
                    <span class="w-2 h-2 bg-green-400 rounded-full mr-2 animate-pulse"></span>
                    Online
                </p>
            </div>
        </div>

        <div id="chat-window" class="flex-1 p-6 overflow-y-auto space-y-6"></div>
        <div id="status-indicator" class="px-6 pb-2 h-6"><p id="status-text" class="text-sm text-gray-400"></p></div>

        <div class="p-4 border-t border-gray-700">
            <div class="flex items-center bg-gray-700 rounded-xl">
                <input type="text" id="user-input" class="flex-1 bg-transparent p-4 focus:outline-none placeholder-gray-400" placeholder="Tanyakan sesuatu...">
                <button id="send-button" class="bg-purple-600 text-white font-semibold rounded-lg p-3 m-2 hover:bg-purple-700 transition-all duration-200 disabled:bg-gray-500">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        const chatWindow = document.getElementById('chat-window');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const statusText = document.getElementById('status-text');

        // --- Konfigurasi API (PENTING!) ---
        // Ganti dengan kunci API asli Anda dari Groq.
        const GROQ_API_KEY = "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";
        
        const API_URL = "https://api.groq.com/openai/v1/chat/completions";

        // --- Otak Lokal Chatbot ---
        const knowledgeBase = {
            "pendaftaran": { 
                keywords: ["daftar", "pendaftaran", "registrasi", "mendaftar"], 
                jawaban: "Anda bisa mendapatkan informasi pendaftaran terbaru dan mendaftar online di halaman PMB resmi Politeknik LP3I Jakarta: <a href='https://pmb.lp3ijkt.ac.id/' target='_blank' class='text-purple-400 hover:underline'>pmb.lp3ijkt.ac.id</a>" 
            },
             "creator": {
                keywords: ["dibuat siapa", "siapa yang buat", "penciptamu", "siapa yg buat", "yg buat kamu"],
                jawaban: "Saya adalah asisten AI yang dikembangkan dan di program oleh M Alif Fadlan."
            }
        };
        
        function displayMessage(text, sender) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('flex', 'items-end', 'max-w-xl', 'animate-fade-in-up');
            let bubbleClass = sender === 'user' ? 'bg-purple-600 text-white rounded-t-xl rounded-l-xl' : 'bg-gray-700 text-white rounded-t-xl rounded-r-xl';
            if (sender === 'user') messageElement.classList.add('self-end', 'flex-row-reverse');
            else messageElement.classList.add('self-start');
            messageElement.innerHTML = `<div class="p-4 ${bubbleClass} shadow-md"><p>${text.replace(/\n/g, '<br>')}</p></div>`;
            chatWindow.appendChild(messageElement);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function updateStatus(text) { statusText.textContent = text; }
        
        async function getBotResponse(query) {
            const lowerCaseQuery = query.toLowerCase();
            
            for (const key in knowledgeBase) {
                if (knowledgeBase[key].keywords.some(k => lowerCaseQuery.includes(k))) {
                    return knowledgeBase[key].jawaban;
                }
            }

            updateStatus("Menghubungi AI super cepat...");
            try {
                const headers = {
                    "Authorization": `Bearer ${GROQ_API_KEY}`,
                    "Content-Type": "application/json"
                };
                
                const payload = { 
                    "model": "llama3-8b-8192",
                    "messages": [
                        {"role": "system", "content": "Anda adalah asisten AI dari kampus LP3I. Jawab pertanyaan dalam bahasa Indonesia dengan ramah dan informatif."},
                        {"role": "user", "content": query}
                    ]
                };

                const response = await fetch(API_URL, { method: 'POST', headers: headers, body: JSON.stringify(payload) });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API request failed: ${errorData.error.message}`);
                }

                const result = await response.json();
                const cleanedText = result.choices[0].message.content;
                return cleanedText || "Maaf, saya tidak bisa menghasilkan jawaban saat ini.";

            } catch (error) {
                console.error("Error calling Groq API:", error);
                return "Maaf, terjadi kesalahan saat menghubungi AI. Coba lagi dalam beberapa saat.";
            }
        }
        
        async function handleUserInput() {
            const query = userInput.value.trim();
            if (query === "") return;

            displayMessage(query, 'user');
            userInput.value = "";
            sendButton.disabled = true;

            const botResponse = await getBotResponse(query);
            
            updateStatus("");
            displayMessage(botResponse, 'bot');
            sendButton.disabled = false;
            userInput.focus();
        }

        sendButton.addEventListener('click', handleUserInput);
        userInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') handleUserInput(); });

        window.onload = () => {
            displayMessage("Halo! Saya AI LP3I, AI dengan respon super cepat. Silakan bertanya.", 'bot');
            userInput.focus();
        };
    </script>
</body>
</html>
